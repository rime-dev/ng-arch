<div class="relative flex flex-col md:flex-row w-full h-full">
  <div class="relative md:absolute w-full h-auto md:h-full adapt-list-project">
    <header class="relative flex flex-row mx-auto py-6 px-4 sm:px-6 lg:px-8 items-center">
      <h1 class="text-3xl font-semibold text-gray-700 dark:text-gray-200">Proyectos</h1>
      <button
        mat-icon-button
        class="block md:hidden ml-auto"
        (click)="toogleMapOnMobile(); updateMap(map)"
      >
        <mat-icon *ngIf="!mapIsOpenOnMobile">map</mat-icon>
        <mat-icon *ngIf="mapIsOpenOnMobile">close</mat-icon>
      </button>
    </header>
    <div class="relative w-full h-full flex flex-row">
      <mat-tab-group
        animationDuration="0ms"
        [selectedIndex]="tabSelected"
        (selectedIndexChange)="changeTab($event)"
        [class.hidden]="mapIsOpenOnMobile"
        [class.block]="!mapIsOpenOnMobile"
        class="w-full h-full"
      >
        <mat-tab>
          <ng-template mat-tab-label>
            {{ 'active' | transloco }} ({{ (activeProjects$ | async)?.length }})
          </ng-template>
          <ng-template matTabContent>
            <ng-container
              *ngTemplateOutlet="
                projectsListTemplate;
                context: {$implicit: activeProjects$ | async}
              "
            ></ng-container>
          </ng-template>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            {{ 'offered' | transloco }} ({{ (otherProjects$ | async)?.length }})
          </ng-template>
          <ng-template matTabContent>
            <ng-container
              *ngTemplateOutlet="projectsListTemplate; context: {$implicit: otherProjects$ | async}"
            ></ng-container>
          </ng-template>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            {{ 'inactive' | transloco }} ({{ (inactiveProjects$ | async)?.length }})
          </ng-template>
          <ng-template matTabContent>
            <ng-container
              *ngTemplateOutlet="
                projectsListTemplate;
                context: {$implicit: inactiveProjects$ | async}
              "
            ></ng-container>
          </ng-template>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            {{ 'finished' | transloco }} ({{ (finishedProjects$ | async)?.length }})
          </ng-template>
          <ng-template matTabContent>
            <ng-container
              *ngTemplateOutlet="
                projectsListTemplate;
                context: {$implicit: finishedProjects$ | async}
              "
            ></ng-container>
          </ng-template>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
  <div
    class="
      md:grid
      w-full
      h-full
      pt-0
      pb-6
      px-4
      md:pb-6 md:pt-20 md:px-6
      adapt-map-project
      relative
      md:fixed
      right-0
      top-0
      z-40
    "
    [class.hidden]="!mapIsOpenOnMobile"
    [class.grid]="mapIsOpenOnMobile"
    [class.subcontainer]="mapIsOpenOnMobile"
  >
    <rng-map
      #map
      class="grid w-full h-full rounded-2xl overflow-hidden"
      [center]="center"
      [data]="points$ | async"
      [overlayClickTemplate]="mapClickTemplate"
    ></rng-map>
  </div>
</div>

<ng-template #mapClickTemplate let-data="data">
  <div *ngIf="data">
    <mat-card
      class="grid w-full mb-2 mat-elevation-z1 cursor-pointer"
      [routerLink]="['../project-view', data.id || data.uid]"
    >
      <div class="flex flex-row">
        <div class="w-full flex flex-col">
          <mat-card-header class="w-full">
            <div mat-card-avatar class="text-center items-center self-center">
              <mat-icon>{{ data.type | projectTypePipe }}</mat-icon>
            </div>
            <mat-card-title>{{ data.title }}</mat-card-title>
            <mat-card-subtitle>{{ data.location.text }}</mat-card-subtitle>
          </mat-card-header>
        </div>
      </div>
    </mat-card>
  </div>
</ng-template>

<ng-template #noProjects>
  <div class="flex flex-col h-48 text-center items-center">
    <div class="m-auto h-36">
      <p class="mb-4">{{ 'noProjects' | transloco }}</p>
      <img class="h-32 w-full" src="assets/undraw_not_found_-60-pq.svg" />
    </div>
  </div>
</ng-template>

<ng-template #projectsListTemplate let-projects>
  <div class="lg:container mx-auto p-4">
    <div class="flex flex-row w-full mb-4 overflow-y-auto">
      <button
        mat-button
        [ngClass]="filterByTypeSelected === 'all' ? 'mat-raised-button' : 'mat-stroked-button'"
        class="mx-2 font-thin min-w-min dark:text-white"
        color="primary"
        (click)="filterByType()"
      >
        <mat-icon class="text-lg">grid_view</mat-icon>
        <span>{{ 'all' | transloco }}</span>
      </button>
      <button
        mat-button
        [ngClass]="filterByTypeSelected === 'paint' ? 'mat-raised-button' : 'mat-stroked-button'"
        class="mx-2 font-thin min-w-min dark:text-white"
        color="primary"
        (click)="filterByType('paint')"
      >
        <mat-icon class="text-lg">format_paint</mat-icon>
        <span>{{ 'paint' | transloco }}</span>
      </button>
      <button
        mat-button
        [ngClass]="
          filterByTypeSelected === 'construction' ? 'mat-raised-button' : 'mat-stroked-button'
        "
        class="mx-2 font-thin min-w-min dark:text-white"
        color="primary"
        (click)="filterByType('construction')"
      >
        <mat-icon class="text-lg">construction</mat-icon>
        <span>{{ 'rehabilitation' | transloco }}</span>
      </button>
    </div>
    <div *ngIf="projects && projects.length > 0; else noProjects" class="grid gap-2 w-full">
      <div *ngFor="let project of projects" class="w-full">
        <rng-project-card [project]="project"></rng-project-card>
      </div>
    </div>
  </div>
</ng-template>
